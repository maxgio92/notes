<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>GitOps multi tenancy notes - maxgio's notes</title><meta name=description content="Escalation temptative: impersonate privileged SA Then, what if a tenant tries to escalate by using one of the Flux controllers privileged ServiceAccounts?
As spec.ServiceAccountName for Reconciliation resource cannot cross-namespace reference Service Accounts, tenants are able to let Flux apply his own resources only with ServiceAccounts that reside in his own Namespaces. Which is, Namespace of the ServiceAccount and Namespace of the Reconciliation resource must match.
He could neither create the Reconciliation resource where a privileged ServiceAccount is present (like flux-system), as the Namespace has to be owned by the Tenant."><meta name=author content><link rel="preload stylesheet" as=style href=https://notes.maxgio.me/app.min.css><link rel="preload stylesheet" as=style href=https://notes.maxgio.me/an-old-hope.min.css><script defer src=https://notes.maxgio.me/highlight.min.js onload=hljs.initHighlightingOnLoad();></script><link rel=preload as=image href=https://notes.maxgio.me/theme.png><link rel=icon href=https://notes.maxgio.me/favicon.ico><link rel=apple-touch-icon href=https://notes.maxgio.me/apple-touch-icon.png><meta name=generator content="Hugo 0.79.1"><meta property="og:title" content="GitOps multi tenancy notes"><meta property="og:description" content="Escalation temptative: impersonate privileged SA Then, what if a tenant tries to escalate by using one of the Flux controllers privileged ServiceAccounts?
As spec.ServiceAccountName for Reconciliation resource cannot cross-namespace reference Service Accounts, tenants are able to let Flux apply his own resources only with ServiceAccounts that reside in his own Namespaces. Which is, Namespace of the ServiceAccount and Namespace of the Reconciliation resource must match.
He could neither create the Reconciliation resource where a privileged ServiceAccount is present (like flux-system), as the Namespace has to be owned by the Tenant."><meta property="og:type" content="article"><meta property="og:url" content="https://notes.maxgio.me/notes/gitops-multi-tenancy-notes/"><meta property="article:published_time" content="2022-07-19T21:04:15+02:00"><meta property="article:modified_time" content="2022-07-19T21:28:21+02:00"><meta itemprop=name content="GitOps multi tenancy notes"><meta itemprop=description content="Escalation temptative: impersonate privileged SA Then, what if a tenant tries to escalate by using one of the Flux controllers privileged ServiceAccounts?
As spec.ServiceAccountName for Reconciliation resource cannot cross-namespace reference Service Accounts, tenants are able to let Flux apply his own resources only with ServiceAccounts that reside in his own Namespaces. Which is, Namespace of the ServiceAccount and Namespace of the Reconciliation resource must match.
He could neither create the Reconciliation resource where a privileged ServiceAccount is present (like flux-system), as the Namespace has to be owned by the Tenant."><meta itemprop=datePublished content="2022-07-19T21:04:15+02:00"><meta itemprop=dateModified content="2022-07-19T21:28:21+02:00"><meta itemprop=wordCount content="202"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="GitOps multi tenancy notes"><meta name=twitter:description content="Escalation temptative: impersonate privileged SA Then, what if a tenant tries to escalate by using one of the Flux controllers privileged ServiceAccounts?
As spec.ServiceAccountName for Reconciliation resource cannot cross-namespace reference Service Accounts, tenants are able to let Flux apply his own resources only with ServiceAccounts that reside in his own Namespaces. Which is, Namespace of the ServiceAccount and Namespace of the Reconciliation resource must match.
He could neither create the Reconciliation resource where a privileged ServiceAccount is present (like flux-system), as the Namespace has to be owned by the Tenant."></head><body class=not-ready data-menu=false><header class=header><p class=logo><a class=site-name href=https://notes.maxgio.me/>maxgio's notes</a><a class=btn-dark></a></p><script>let bodyClx=document.body.classList;let btnDark=document.querySelector('.btn-dark');let sysDark=window.matchMedia('(prefers-color-scheme: dark)');let darkVal=localStorage.getItem('dark');let setDark=(isDark)=>{bodyClx[isDark?'add':'remove']('dark');localStorage.setItem('dark',isDark?'yes':'no');};setDark(darkVal?darkVal==='yes':sysDark.matches);requestAnimationFrame(()=>bodyClx.remove('not-ready'));btnDark.addEventListener('click',()=>setDark(!bodyClx.contains('dark')));sysDark.addEventListener('change',(event)=>setDark(event.matches));</script></header><main class=main><article class=post-single><header class=post-title><p><time>:date_medium</time></p><h1>GitOps multi tenancy notes</h1></header><section class=post-content><h3 id=escalation-temptative-impersonate-privileged-sa>Escalation temptative: impersonate privileged SA</h3><p>Then, what if a tenant tries to escalate by using one of the Flux controllers privileged ServiceAccounts?</p><p>As spec.ServiceAccountName for Reconciliation resource cannot cross-namespace reference Service Accounts, tenants are able to let Flux apply his own resources only with ServiceAccounts that reside in his own Namespaces. Which is, Namespace of the ServiceAccount and Namespace of the Reconciliation resource must match.</p><p>He could neither create the Reconciliation resource where a privileged ServiceAccount is present (like flux-system), as the Namespace has to be owned by the Tenant. Capsule would block those Reconciliation resource creation requests.</p><h3 id=escalation-temptative-create-and-impersonate-privileged-sa>Escalation temptative: create and impersonate privileged SA</h3><p>Then, what if a tenant tries to escalate by creating a privileged ServiceAccount inside on of his own Namespaces?</p><p>A tenant could create a ServiceAccount in an owned Namespace, but he can&rsquo;t neither bind at cluster-level nor at a non-owned Namespace-level a ClusterRole, as that wouldn&rsquo;t be permitted by Capsule admission controllers.</p><p>Now let&rsquo;s go on with the practical part.</p><h3 id=tenant-tries-to-chown-other-tenant-namespaces>Tenant tries to chown other Tenant Namespaces</h3><p>This is not permitted for the same reason, he can’t operate on Namespaced resources where those Namespaces are part of another Tenant. Capsule request validation would not pass.</p><h3 id=expand>EXPAND</h3><p>…</p></section><nav class=post-nav><a class=next href=https://notes.maxgio.me/notes/blog/><span>Blogging</span><span>→</span></a></nav></article></main><footer class=footer><p>&copy; 2022 <a href=https://notes.maxgio.me/>maxgio's notes</a></p><p>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</p><p><a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper 5.1</a></p></footer></body></html>